---
title: "COVID-19 Survey Analysis (Part 2: Data Extraction & Preprocessing)"
author: "Nathan K. Chan"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: 
      collapsed: true
      smooth_scroll: true
    number_sections: false
    code_folding: show
    df_print: paged
---

<!-- **Recommended: For HTML document, hide code snippets by choosing the respective option in top right drop-down menu for improved readability.** -->

```{css codeoutput, echo=FALSE}
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 200px;
}
```

***

**To visit this project on GitHub, please visit this link:** [https://nathankchan.github.io/covid-19-survey-analysis/](https://nathankchan.github.io/covid-19-survey-analysis/)

*NB: Show or hide all code snippets using the* `Code` *button located in the upper right corner.*

<center><span style = "color:blue">**Please note that this report is under development and may be modified at a later time.**</span></center>

***

### Table of Contents

1. [**Preamble**](#preamble)
2. [**Data extraction**](#extract)
3. [**Basic characterization**](#characterize)
4. [**Data preprocessing**](#preprocess)
5. [**Appendix**](#appendix)

# 1. Preamble {#preamble}

***

This report section demonstrates an automated process to download data from [Harvard Dataverse](https://dataverse.harvard.edu/). We also examine the structure of the data and prepare it for analysis. Key topics discussed include *data cleaning* and *imputation of missing data*.

If you choose to follow along with code demonstrations, please initialize your environment by sourcing `00_init.R` and installing all required packages (see Part 1). Then, restart R and run the code block below.

```{r start, message=FALSE, warning=FALSE, include=TRUE}
source(paste0(getwd(), "/scripts/02_cleandata.R"))
```

# 2. Data extraction {#extract}

***

The **COVID-19 Behavior Determinants Database** can be accessed via Harvard Dataverse at [doi.org/10.7910/DVN/NILCAV](doi.org/10.7910/DVN/NILCAV). To analyze this data, we will need to download the SPSS file `COVID-19 Behavior Determinants Database_v1.0.sav` and load this data into R. 

The script `01_loaddata.R` automates the process of downloading and extracting data from Harvard Dataverse. Since scripts are nested, running `02_cleandata.R` will automatically source `00_init.R` to set up the environment and `01_loaddata.R` to load the data. 

Data are loaded into a "tibble" (i.e., data frame) named `coviddata`. 

# 3. Basic characterization {#characterize}

***

Let's explore `coviddata` to understand what it contains. Using `dim()`, we can determine the dimensions of `coviddata` (i.e., the number of rows and columns it contains). We can also view the contents of `coviddata` for a qualitative perspective.

```{r characterize, echo=TRUE}

dim(coviddata)

head(coviddata)

```

<br>

`dim()` shows that `coviddata` contains 8070 rows and 401 columns. Based on the table, rows may represent individual participants, whereas columns represent data collected from participants (e.g., survey responses, identifiers, etc.). 

The contents of each column are not immediately obvious. For example, column "S2" likely describes years, but it is not clear if the data indicate year of birth or another time-related measure. Some columns appear to contain character strings (e.g., "S3r6oe"), whereas others seem to contain coded values (e.g., "S4").

Fortunately, since SPSS files contain a data dictionary, we can identify columns contained in `coviddata`. Questions and values associated with each column were saved in the `label` and `labels` attributes of columns in `coviddata`. 

For your convenience, these attributes were extracted into a list named `datadict`. Elements of `datadict` correspond to columns of `coviddata`, where each element contains the question, values, and table of counts for each value of a given column. Let's investigate column "S5" and "S5r15oe". <a name = "ddS5"> </a>

```{r characterize1}

datadict$S5
datadict$S5r15oe

```

As can be seen above, column "S5" encodes the religion of the participant as a number. Numbers correspond to a look-up table containing labels. Thus, column "S5" is a categorical/nominal variable (or in R terms, a `factor`).

Meanwhile, column "S5r15oe" encodes the short-answer response of participants that answered "15" (i.e., "Other (please specify)") to "S5". Most participants did not respond to this question, and those that did respond provided custom answers. Thus, column "S5r15oe" is a column of qualitative responses.

Strictly speaking, it is possible to perform quantitative analysis of qualitative data using methods like natural language processing. However, such an analysis is outside the scope of this project. As such, the remainder of this project will focus on quantitative data (i.e., data that can be represented as a number). We will consider continuous, ordinal, and categorical/nominal variables, and we will exclude all qualitative variables.

# 4. Data preprocessing {#preprocess}

***

The data require preparation for outlier and inferential analyses. Specifically, the data must

1. consist of values coercible to numeric (including categorical variables);
2. contain no missing values (i.e., no `NA` values); and
3. for inferential analyses specifically, contain no outliers.

The first two criteria are discussed below, while the third criterion is deferred to [Part 3]().

## 4.1. Select numeric data

We can meet the first criteria by filtering out all columns with data that cannot be coerced to numeric. Let's call this new tibble `coviddata_num`. 

```{r selectnum}

coviddata_num <- coviddata[, which(sapply(coviddata, is.numeric))]

```

## 4.2. Handling missing data {#fig1}

No missing data are permitted for upcoming analyses. While we could exclude all columns with missing data, this is an indiscriminate approach that limits the breadth of potential associations we will detect. It also could introduce bias if data are not missing at random. Instead, we should investigate the nature of the "missingness" and determine how to handle missing data on a case-by-case basis. 

Missing data can be classified into three types: 

1. **missing completely at random (MCAR)**, meaning that data are missing for reasons unrelated to observed or unobserved variables (e.g., participants randomly skipped questions about smoking status);
2. **missing at random (MAR)**, meaning that data are missing for known reasons that are unrelated to the variable of interest (e.g., smokers are less likely to complete a medical history survey vs. non-smokers, but the unobserved responses from missing smokers do not differ from the observed responses from responding smokers); and
3. **missing not at random (MNAR)**, meaning that data are missing for reasons related to the variable of interest itself (e.g., smokers with poorer health are less likely to complete a medical history survey, such that the set of responses from responding smokers is not representative of all smokers).

To handle the missing data, we have three options: 

1. **exclude entire variables or cases** containing missing data;
2. **recode `NA` values** to some sensible values; or
3. **impute `NA` values** to ensure all cases are complete.

One option to investigate missingness is via visualization. [Figure 1](#fig1) depicts patterns of missing data in `coviddata_num` by plotting `NA` values on a heatmap. Yellow cells indicate missing values. Ultimately, our goal will be to minimize the amount of yellow in this plot. 

```{r plotmissing, class.source = 'fold-hide'}

plot_missing(coviddata_num, title = "Figure 1", subtitle = "Missing values in coviddata_num")

```

The horizontal yellow stripes suggest that some variables contain mostly missing values. Meanwhile, the vertical banding patterns suggest that some observations are missing by participant across one or more related variables. 

Let's try to untangle the structure of the missingness. We know that the data were collected at three discrete time points, and each case belongs to exactly one time point. The columns `Timepoint_1`, `Timepoint_2`, and `Timepoint_3` code this information as dummy variables, using `1` to indicate "yes" and `NA` to indicate "no" in the respective column. Since `NA` is effectively used to represent a "level" of a binary variable, let's convert these `NA`s to `0`s. Then, let's plot the missing values while sorting and marking values by Timepoint.

```{r plotmissing1}

# Timepoint variables are actually boolean; replace NA with 0 in each Timepoint
coviddata_num[-which(coviddata_num$Timepoint_1 == 1), "Timepoint_1"] <- 0
coviddata_num[-which(coviddata_num$Timepoint_2 == 1), "Timepoint_2"] <- 0
coviddata_num[-which(coviddata_num$Timepoint_3 == 1), "Timepoint_3"] <- 0

```

### 4.2.1. Missing variables by Timepoint {.tabset}

As seen in the figures below, certain variables are completely missing in each Timepoint. This is likely because some questions not were asked at all Timepoints (e.g., researchers added or removed survey questions at later Timepoints). Since these variables are empty, neither recoding nor imputation are possible. We will exclude these variables from further analysis.

The fourth tab shows missing values across the entire dataset after excluding variables completely missing at any Timepoint. Excluding these variables helped, and the amount of yellow in the plot is greatly reduced in [Figure 5](#fig5) compared to [Figure 1](#fig1). However, some missing values remain. Further investigation into the contents of the data with missing values is required.

#### Timepoint_1

```{r plotmissing2, class.source = 'fold-hide'}
coviddata_num[which(coviddata_num$Timepoint_1 == 1), ] %>% plot_missing(data = ., title = "Figure 2", subtitle = "Missing values in coviddata_num at Timepoint_1")
```

#### Timepoint_2

```{r plotmissing3, class.source = 'fold-hide'}
coviddata_num[which(coviddata_num$Timepoint_2 == 1), ] %>% plot_missing(data = ., title = "Figure 3", subtitle = "Missing values in coviddata_num at Timepoint_2")

```

#### Timepoint_3

```{r plotmissing4, class.source = 'fold-hide'}
coviddata_num[which(coviddata_num$Timepoint_3 == 1), ] %>% plot_missing(data = ., title = "Figure 4", subtitle = "Missing values in coviddata_num at Timepoint_3")
```

#### Variables completely missing by Timepoint excluded {#fig5}

```{r plotmissing5, class.source = 'fold-hide'}

vars_na1 <-
  coviddata_num %>% 
  .[which(.$Timepoint_1 == 1),] %>%
  .[, which(sapply(., function(x) all(is.na(x))))] %>%
  names()
vars_na2 <-
  coviddata_num %>%
  .[which(.$Timepoint_2 == 1),] %>%
  .[, which(sapply(., function(x) all(is.na(x))))] %>%
  names()
vars_na3 <-
  coviddata_num %>%
  .[which(.$Timepoint_3 == 1),] %>%
  .[, which(sapply(., function(x) all(is.na(x))))] %>%
  names()

vars_naall <- unique(c(vars_na1, vars_na2, vars_na3))

coviddata_exclNA <- coviddata_num[, -which(names(coviddata_num) %in% vars_naall)]

plot_missing(data = coviddata_exclNA, title = "Figure 5", subtitle = "Missing values excluding completely missing variables by Timepoint")

```

### 4.2.2. Recoding values by variable

Yellow cells in [Figure 5](#fig5) indicate that missing values exist in the data. Similarly named variables are grouped together. Yellow vertical bands suggests that some participants did not respond to sets of related questions. The precise reason for missingness is not immediately clear, so we should determine how to handle missing data on a case-by-case basis. 

At the same time, data that appear to be complete may still contain missing values! Recall the output of `datadict$S5` printed [above](#ddS5). Under `$Values`, we can see that the value `99` is used when participants respond with `I'd rather not say`. In other words, `99` is an explicit code for nonresponses in column `S5`. These and similar nonresponses (e.g., `I don't know`, `Prefer not to answer`, etc.) essentially function as missing data in the variable.

**Thus, we will review** ***every*** **variable in the dataset and determine whether preprocessing is required.**

If `NA` values exist, we should determine if the `NA`s are MCAR, MAR. or MNAR. Variables with `NA`s that are MCAR or MAR should be identified, and in the next subsection, we will impute the missing values. 

Meanwhile, `NA` values that are MNAR should be "repaired" if the reason for missingness is known. For example, the `NA` values in `S7C` ("Are you temporarily or permanently laid off?") are "missing" because these participants answered `No` or `I'd rather not say` to `S7B` ("Have you been terminated/laid off because of COVID-19?"). In other words, the `NA` values in `S7C` are meaningful and indicate that the question is "Not applicable" to the participant. We should explicitly encode this type of "Not applicable" information as a level of the variable where possible (e.g., label as `0`). 

This screening process will also give us an opportunity to classify each variable as either categorical, ordinal, or continuous. The variable type is important to identify, as it affects methods for imputation and preprocessing of correspondence analysis data.

Let's generate a data dictionary of extant variables from `coviddata_exclNA` (which excludes empty variables identified in the previous section). Then, let's review the output of `datadict_exclNA`. 

```{r datadict_exclNA}

datadict_exclNA <- sapply(coviddata_exclNA, get_var_info, simplify = F)

# At some point I'll figure out a more elegant solution for displaying the data dictionary through Shiny; for now, just print the entire object out.
print(datadict_exclNA)

```

Next, let's categorize variables by type, plan the necessary preprocessing steps, then perform preprocessing. 

```{r preprocess}

attach(coviddata_exclNA)

# Put all categorical variables that do not need preprocessing here
vars_cat <- bind_cols(
  "Timepoint_1"     = Timepoint_1,      # Identifier for time when survey collected
  "Timepoint_2"     = Timepoint_2,      # Identifier for time when survey collected
  "Timepoint_3"     = Timepoint_3,      # Identifier for time when survey collected
  "S6A"             = S6A,              # Relationship status
  "S6D"             = S6D,              # Health care worker (y/n)
  "RF1r1"           = RF1r1,            # Have heart disease (y/n)
  "RF1r2"           = RF1r2,            # Have hypertension (y/n)
  "RF1r3"           = RF1r3,            # Have lung disease (y/n)
  "RF1r4"           = RF1r4,            # Have diabetes (y/n)
  "RF1r5"           = RF1r5,            # Have cancer (y/n)
  "RF1r6"           = RF1r6,            # Have chronic kidney disease (y/n)
  "RF1r7"           = RF1r7,            # Have obesity (y/n)
  "RF2"             = RF2,              # Have weakened immune system (y/n)
  "ASr1"            = ASr1,             # Have fever/chills/shakes (y/n)
  "ASr2"            = ASr2,             # Have cough (y/n)
  "ASr3"            = ASr3,             # Have shortness of breath (y/n)
  "ASr4"            = ASr4,             # Have tired or fatigued(y/n)
  "ASr5"            = ASr5,             # Have lost appetite (y/n)
  "ASr6"            = ASr6,             # Have muscle aches and pains (y/n)
  "ASr7"            = ASr7,             # Have nasal congestion (y/n)
  "ASr8"            = ASr8,             # Have sore throat (y/n)
  "ASr9"            = ASr9,             # Have excessive sputum (y/n)
  "ASr10"           = ASr10,            # Have lost smell (y/n)
  "ASr11"           = ASr11,            # Have lost taste (y/n)
  "ASr12"           = ASr12,            # Have diarrhea (y/n)
  "ASr13"           = ASr13,            # Have other symptoms (y/n)
  "C1"              = C1,               # Ever tested for COVID-19 (y/n)
  "CVSQ1"           = CVSQ1,            # Source of health information (incl. other)
  "CVSQ2"           = CVSQ2,            # Belief of origin of COVID-19 (incl. other)
  "CVSQ3"           = CVSQ3,            # Had COVID/what was outcome
  "CVSQCVSQ4"       = CVSQCVSQ4,        # Close family member or friend that is health care worker (y/n)
  "CVSQCVSQ5"       = CVSQCVSQ5,        # Close family member or friend that is high risk (y/n)
  "CVSQCVSQ6"       = CVSQCVSQ6,        # Close family member or friend in senior's residence (y/n)
  "CVSQCVSQ7"       = CVSQCVSQ7,        # Close family member or friend in long-term care (y/n)
  "noanswerS15_r0"  = noanswerS15_r0,   # cat; Number of drinks in last 7 days (non-drinkers)
  "noanswerS15_r1"  = noanswerS15_r1,   # cat; Number of drinks in last 7 days (less than 1 per week)
  "noanswerS15_r2"  = noanswerS15_r2,   # cat; Number of drinks in last 7 days (it depends)
  "S16A"            = S16A,             # Use of cannabis products (combine with below)
  "noanswerS17A_r0" = noanswerS17A_r0,  # cat; Number of cigarettes (non-smokers)
  "noanswerS17A_r1" = noanswerS17A_r1,  # cat; Number of cigarettes (less than 1 per day)
  "noanswerS17A_r2" = noanswerS17A_r2,  # con; Number of cigarettes (it depends)
  "noanswerS17B_r0" = noanswerS17B_r0,  # cat; Number of e-cigarettes (non-users)
  "noanswerS17B_r1" = noanswerS17B_r1,  # cat; Number of e-cigarettes (less than 1 per day)
  "noanswerS17B_r2" = noanswerS17B_r2   # cat; Number of e-cigarettes (it depends)
)

# Put all ordinal variables that do not need preprocessing here
vars_ord <- bind_cols(
  "S10A"          = S10A,                 # Highest level of education
  "S8x1S8A"       = S8x1S8A,              # Income reduced by COVID-19
  "S8x1S8B"       = S8x1S8B,              # In financial distress
  "S8x1S8C"       = S8x1S8C,              # Trouble making ends meet
  "SPFQr1"        = SPFQr1,               # Comply with social distancing (avoid groups)
  "SPFQr2"        = SPFQr2,               # Comply with social distancing (maintain 6ft distance in community)
  "SPFQr3"        = SPFQr3,               # Comply with social distancing (keep distance from people at risk)
  "SPQr1"         = SPQr1,                # Stay at home unless for work
  "SPQr2"         = SPQr2,                # Avoid non-essential trips
  "SPQr3"         = SPQr3,                # Keep distance if leaving home
  "SPQr4"         = SPQr4,                # Limit close contacts with people at high risk
  "SPQr5"         = SPQr5,                # Avoid crowded places
  "SPQr6"         = SPQr6,                # Avoid common greetings (hugging and kissing)
  "SPQr7"         = SPQr7,                # Disinfect hands often
  "SPQr8"         = SPQr8,                # Wash or disinfect hands for at least 20 seconds
  "SPQr9"         = SPQr9,                # Cough or sneeze into bend of arm
  "SPQr10"        = SPQr10,               # Avoid touching eyes, nose, mouth
  "SPQ11A"        = SPQ11A,               # Exercise frequency
  "SSSQr1"        = SSSQr1,               # Easily influenced by people's opinions
  "SSSQr2"        = SSSQr2,               # Easily influenced by commercials
  "SSSQr3"        = SSSQr3,               # Likely to cough or sneeze when seeing others do so
  "SSSQr4"        = SSSQr4,               # Imagining drink can make me thirsty
  "SSSQr5"        = SSSQr5,               # Salesperson can make me want their product
  "SSSQr6"        = SSSQr6,               # Practical advice from magazines or TV
  "SSSQr7"        = SSSQr7,               # Nicely displayed product makes me want to buy
  "SSSQr8"        = SSSQr8,               # Seeing shiver makes me feel a chill
  "SSSQr9"        = SSSQr9,               # Get style from celebrities
  "SSSQr10"       = SSSQr10,              # Feel same feelings when others share feelings
  "SSSQr11"       = SSSQr11,              # Follow other people's advice when making decisions
  "SSSQr12"       = SSSQr12,              # Reading tasty descriptions of dishes makes mouth water
  "SSSQr13"       = SSSQr13,              # Get good ideas from others
  "SSSQr14"       = SSSQr14,              # Frequently change opinions after talking with others
  "SSSQr15"       = SSSQr15,              # Lotion commercials make skin feel dry
  "SSSQr16"       = SSSQr16,              # Discover favorite things from friends
  "SSSQr17"       = SSSQr17,              # Follow current fashion trends
  "SSSQr18"       = SSSQr18,              # Thinking about scary makes heart pound
  "SSSQr19"       = SSSQr19,              # Pick up habits from friends
  "SSSQr20"       = SSSQr20,              # Feel ill if told don't look well
  "SSSQr21"       = SSSQr21,              # Important to fit in
  "RQr1"          = RQr1,                 # Saftey first
  "RQr2"          = RQr2,                 # Do not take risks with my health
  "RQr3"          = RQr3,                 # Avoid risks
  "RQr4"          = RQr4,                 # Regularly take risks
  "RQr5"          = RQr5,                 # Dislike not knowing what is going to happen
  "RQr6"          = RQr6,                 # View risks as a challenge
  "RQ7"           = RQ7,                  # Risk avoider vs risk seeker
  "DRIQInfor1"    = DRIQInfor1,           # Experience presence of divine
  "DRIQInfor2"    = DRIQInfor2,           # Religious/spiritual beliefs lie behind whole approach to life
  "DRIQInfor3"    = DRIQInfor3,           # Try hard to carry religious/spiritual beliefs into all dealings in life
  "TIPIQr1"       = TIPIQr1,              # Extroverted or enthusiastic
  "TIPIQr2"       = TIPIQr2,              # Critical or quarrelsome
  "TIPIQr3"       = TIPIQr3,              # Dependable or self-disciplined
  "TIPIQr4"       = TIPIQr4,              # Anxious or easily upset
  "TIPIQr5"       = TIPIQr5,              # Open to new experiences or complex
  "TIPIQr6"       = TIPIQr6,              # Reserved or quiet
  "TIPIQr7"       = TIPIQr7,              # Sympathetic or warm
  "TIPIQr8"       = TIPIQr8,              # Disorganized or careless
  "TIPIQr9"       = TIPIQr9,              # Calm or emotionally stable
  "TIPIQr10"      = TIPIQr10,             # Conventional or un-creative
  "CTQr1"         = CTQr1,                # All levels of government are capable concerning COVID-19
  "CTQr2"         = CTQr2,                # All levels of government are experts concerning COVID-19
  "CTQr3"         = CTQr3,                # All levels of government carry duties out well concerning COVID-19
  "CTQr4"         = CTQr4,                # All levels of government will do their best to help citizens concerning COVID-19
  "CTQr5"         = CTQr5,                # All levels of government act in the interest of citizens concerning COVID-19
  "CTQr6"         = CTQr6,                # All levels of government are interested in the well-being of citizens concerning COVID-19
  "CTQr7"         = CTQr7,                # All levels of government approach citizens in sincere ways concerning COVID-19
  "CTQr8"         = CTQr8,                # All levels of government are honest concerning COVID-19
  "HCQr1"         = HCQr1,                # Positive thinking can help fight off minor illness
  "HCQr2"         = HCQr2,                # Alternative/holistic medicine should be subject to more scientific testing
  "HCQr3"         = HCQr3,                # Important to be careful about lifestyle when stressed
  "HCQr4"         = HCQr4,                # Alternative/holistic medicine can be dangerous by preventing people getting proper treatment
  "HCQr5"         = HCQr5,                # Symptoms of illness made worse by depression
  "HCQr6"         = HCQr6,                # Alternative/holistic medicine used only as last resort
  "HCQr7"         = HCQr7,                # Stressful life events increase likelihood of illness
  "HCQr8"         = HCQr8,                # Worthwhile to try complementary medicine before seeing doctor
  "HCQr9"         = HCQr9,                # Conflict with others has no effect on health
  "HCQr10"        = HCQr10,               # Alternative/holistic medicine only used for minor ailments and not serious illness
  "HCQr11"        = HCQr11,               # Important to find balance between work and relaxation to stay healthy
  "HCQr12"        = HCQr12,               # Alternative/holistic medicine builds up body's defenses leading to permanent cure
  "LCQr1"         = LCQr1,                # Life is determined by own actions
  "LCQr2"         = LCQr2,                # Able to protect personal interests
  "LCQr3"         = LCQr3,                # Can determine what will happen in my life
  "LCQr4"         = LCQr4,                # Life controlled by accidental findings
  "LCQr5"         = LCQr5,                # No chance of protecting personal interest from bad luck
  "LCQr6"         = LCQr6,                # I get what I want because I'm lucky
  "LCQr7"         = LCQr7,                # Little chance of protecting personal interests when conflict with strong pressure groups
  "LCQr8"         = LCQr8,                # Life chiefly controlled by powerful others
  "LCQr9"         = LCQr9,                # Feel like what happens in life determined by powerful people
  "VAXQr1"        = VAXQr1,               # Feel safe after vaccination
  "VAXQr2"        = VAXQr2,               # Rely on vaccines to stop serious infectious diseases
  "VAXQr3"        = VAXQr3,               # Feel protected after getting vaccinated
  "VAXQr4"        = VAXQr4,               # Vaccines appear safe but have problems not yet discovered
  "VAXQr5"        = VAXQr5,               # Vaccines can cause unforeseen problems in children
  "VAXQr6"        = VAXQr6,               # Worry about unknown effects of vaccines in future
  "VAXQr7"        = VAXQr7,               # Vaccines make a lot of money for pharmaceutical companies
  "VAXQr8"        = VAXQr8,               # Authorities promote vaccination for financial gain not health
  "VAXQr9"        = VAXQr9,               # Vaccination programs are a big con
  "VAXQr10"       = VAXQr10,              # Natural immunity lasts longer than vaccination
  "VAXQr11"       = VAXQr11,              # Natural exposure to viruses and germs gives safest protection
  "VAXQr12"       = VAXQr12,              # Exposed to diseases naturally safer for immune system vs vaccination
  "GTSQr1"        = GTSQr1,               # Most people are basically honest
  "GTSQr2"        = GTSQr2,               # Most people are trustworthy
  "GTSQr3"        = GTSQr3,               # Most people are basically good and kind
  "GTSQr4"        = GTSQr4,               # Most people are trustful of others
  "GTSQr5"        = GTSQr5,               # I am trustful
  "GTSQr6"        = GTSQr6,               # Most people respond in kind when they are trusted by others
  "PAQ1"          = PAQ1,                 # Political spectrum (communism to fascism)
  "ABQr1"         = ABQr1,                # Listen to older people about how to behave
  "ABQr2"         = ABQr2,                # Question judgment of umpires or referees
  "ABQr3"         = ABQr3,                # Do what authoritative figures tell you to do
  "ABQr4"         = ABQr4,                # Criticize people who are rude to superiors
  "ABQr5"         = ABQr5,                # Encourage young people to do what they want even if against parents wishes
  "ABQr6"         = ABQr6,                # Dress to be acceptable to people that run the place
  "ABQr7"         = ABQr7,                # Treat experts with respect even when you don't think much of them personally
  "ABQr8"         = ABQr8,                # Support left-wing radical policies
  "ABQr9"         = ABQr9,                # Take part in demonstrations to show opposition to policies you do not like
  "ABQr10"        = ABQr10,               # Express approval for work of school teachers
  "ABQr11"        = ABQr11,               # Go to church
  "ABQr12"        = ABQr12,               # Make fun of police
  "ABQr13"        = ABQr13,               # Look for guidance from someone wiser
  "ABQr14"        = ABQr14,               # Sympathize with rebels
  "ABQr15"        = ABQr15,               # Break speed limit or encourage driver to do so if safe when in hurry
  "ABQr16"        = ABQr16,               # Follow doctor's orders
  "ABQr17"        = ABQr17,               # Question what you hear on news
  "ABQr18"        = ABQr18,               # Cross road against pedestrian traffic lights
  "ABQr19"        = ABQr19,               # Ask for a second opinion when uncertain about doctor's advice
  "ABQr20"        = ABQr20,               # Stand when playing national anthem in public
  "ABQr21"        = ABQr21,               # Express contempt for politicians
  "ABQr22"        = ABQr22,               # Annoyed when people sneer at those in authority
  "ABQr23"        = ABQr23,               # Show special respect for people in high positions
  "ABQr24"        = ABQr24,               # Speak up against boss when acting unfairly
  "CVSQ8_Q9CVSQ8" = CVSQ8_Q9CVSQ8,        # Willing to get vaccinated against COVID-19
  "PANAS_1"       = PANAS_1,              # Interested
  "PANAS_2"       = PANAS_2,              # Distressed
  "PANAS_3"       = PANAS_3,              # Excited
  "PANAS_4"       = PANAS_4,              # Upset
  "PANAS_5"       = PANAS_5,              # Strong
  "PANAS_6"       = PANAS_6,              # Guilty
  "PANAS_7"       = PANAS_7,              # Scared
  "PANAS_8"       = PANAS_8,              # Hostile
  "PANAS_9"       = PANAS_9,              # Enthusiastic
  "PANAS_10"      = PANAS_10,             # Proud
  "PANAS_11"      = PANAS_11,             # Irritable
  "PANAS_12"      = PANAS_12,             # Alert
  "PANAS_13"      = PANAS_13,             # Ashamed
  "PANAS_14"      = PANAS_14,             # Inspired
  "PANAS_15"      = PANAS_15,             # Nervous
  "PANAS_16"      = PANAS_16,             # Determined
  "PANAS_17"      = PANAS_17,             # Attentive
  "PANAS_18"      = PANAS_18,             # Jittery
  "PANAS_19"      = PANAS_19,             # Active
  "PANAS_20"      = PANAS_20,             # Afraid
  "ECR_1"         = ECR_1,                # Uncomfortable when other people want to be close
  "ECR_2"         = ECR_2,                # Worry about feeling abandoned
  "ECR_3"         = ECR_3,                # Tell people whom I feel close just about everything
  "ECR_4"         = ECR_4,                # Need reassurance that I am loved
  "ECR_5"         = ECR_5,                # Don't feel comfortable opening up to other people
  "ECR_6"         = ECR_6,                # Worry a lot about relationships
  "ECR_7"         = ECR_7,                # Discuss problems and concerns with people close to me
  "ECR_8"         = ECR_8,                # Find that other people don't want to get as close as I would like
  "ECR_9"         = ECR_9,                # Avoid getting too close to other people
  "ECR_10"        = ECR_10,               # Worry that other people won't care about me as much as I care about them
  "ECR_11"        = ECR_11,               # Don't mind asking other people about comfort, advice, or help
  "ECR_12"        = ECR_12,               # Get frustrated when other people are not around as much as I would like
  "ECR_13"        = ECR_13,               # Prefer not to be too close to other people
  "ECR_14"        = ECR_14,               # Worry a fair about about losing people I feel close to
  "ECR_15"        = ECR_15,               # Helps to turn to other people in times of need
  "ECR_16"        = ECR_16                # Resent when people I am close to spend time away from me
)

# Put all continuous variables that do not need preprocessing here
vars_con <- bind_cols(
  "S2" = S2 # Year of birth
)

vars_dealwithlater <- bind_cols(
  "Provinces_Canada" = Provinces_Canada  # cat; Province (for Canadian responses, incl. NA for US)
)

vars_excl <- bind_cols(
  "Primary_Case" = Primary_Case,      # Unknown (incl. NA)
  "C1AA"         = C1AA              # ord; When tested for COVID-19 (incl. 99 for missing; too many NA)
)

# These variables need NAs converted to 0 then combined with vars_cat
vars_catnom_convertto0 <- bind_cols(
  "S6E"            = S6E,               # Hospital or long-term care worker (y/n/NA)
  "S16B"           = S16B,              # Type of cannabis product (incl. NA)
  "noanswerS16C_r1" = noanswerS16C_r1,  # cat; Number of cannabis products (less than 1 per day; incl. NA)
  "noanswerS16C_r2" = noanswerS16C_r2,  # cat; Number of cannabis products (it depends; incl. NA)
  "C1B"            = C1B,               # Type of testing (incl. NA)
  "C1C"            = C1C                # COVID-19 Detected (incl. NA)
)

S6E <- S6E %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not a health care worker" = 2),
  label = attr(., "label", exact = TRUE))
S6E[is.na(S6E)] <- 2
S16B <- S16B %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not a cannabis/marijuana user" = 0),
  label = attr(., "label", exact = TRUE))
S16B[is.na(S16B)] <- 0
noanswerS16C_r1 <- noanswerS16C_r1 %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not a cannabis/marijuana user" = 2),
  label = attr(., "label", exact = TRUE))
noanswerS16C_r1[is.na(noanswerS16C_r1)] <- 2
noanswerS16C_r2 <- noanswerS16C_r2 %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not a cannabis/marijuana user" = 2),
  label = attr(., "label", exact = TRUE))
noanswerS16C_r2[is.na(noanswerS16C_r2)] <- 2
C1B <- C1B %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not tested" = 0),
  label = attr(., "label", exact = TRUE))
C1B[is.na(C1B)] <- 0
C1C <- C1C %>% labelled(
  ., 
  labels = c(attr(., "labels", exact = TRUE), "Not tested" = 0),
  label = attr(., "label", exact = TRUE))
C1C[is.na(C1C)] <- 0
vars_cat <- bind_cols(
  vars_cat, 
  "S6E" = S6E,
  "S16B" = S16B,
  "noanswerS16C_r1" = noanswerS16C_r1,
  "noanswerS16C_r2" = noanswerS16C_r2,
  "C1B" = C1B,
  "C1C" = C1C)

# These variables need to be passed through mice to impute NA values
vars_catbin_NA <- bind_cols(
  # Categorical variables; impute with logreg for binary 
  "SDSAQr1"        = SDSAQr1,           # Willing to marry East Asian descent (y/n/NA)
  "SDSAQr2"        = SDSAQr2,           # Willing to accept East Asian as a close personal friend (y/n/NA)
  "SDSAQr3"        = SDSAQr3,           # Willing to have East Asian as neighbor (y/n/NA)
  "SDSAQr4"        = SDSAQr4,           # Willing to have East Asian as coworker (y/n/NA)
  "SDSAQr5"        = SDSAQr5,           # Willing to have East Asian as citizen (y/n/NA)
  "SDSAQr6"        = SDSAQr6,           # Willing to have East Asian as non-citizen visitor (y/n/NA)
  "SDSAQr7"        = SDSAQr7,           # Willing to exclude East Asian from visiting country (y/n/NA)
  "SDSEQr1"        = SDSEQr1,           # Willing to marry Northern European descent (y/n/NA)
  "SDSEQr2"        = SDSEQr2,           # Willing to accept Northern European as a close personal friend (y/n/NA)
  "SDSEQr3"        = SDSEQr3,           # Willing to have cartoon as neighbor (y/n/NA)
  "SDSEQr4"        = SDSEQr4,           # Willing to have Northern European as coworker (y/n/NA)
  "SDSEQr5"        = SDSEQr5,           # Willing to have Northern European as citizen (y/n/NA)
  "SDSEQr6"        = SDSEQr6,           # Willing to have Northern European as non-citizen visitor (y/n/NA)
  "SDSEQr7"        = SDSEQr7            # Willing to exclude Northern European from visiting country (y/n/NA)
)

# These variables need to be passed through mice to impute NA values
# There are no categorical unordered variables with NA values that do not need conversion...
# vars_catnom_NA <- bind_cols(
#   
# )

# These variables need to be passed through mice to impute NA values
vars_ord_NA <- bind_cols(
  # Ordinal variables; impute with polr for ordered
  "SPQ11B"         = SPQ11B,            # Leave home to exercise (incl. NA)
  "SPQ11C"         = SPQ11C,            # Stay close to home (incl. NA)
  "CVSQ2b"         = CVSQ2b,            # Government messaging suggest end to social distancing (incl. NA)
  "PVDr1"          = PVDr1,             # Bothered by people sneezing without covering mouths (incl. NA)
  "PVDr2"          = PVDr2,             # If illness going around, I will get it (incl. NA)
  "PVDr3"          = PVDr3,             # Comfortable sharing water bottle with friend (incl. NA)
  "PVDr4"          = PVDr4,             # Don't like chewed on pencils (incl. NA)
  "PVDr5"          = PVDr5,             # Past experience make me believe unlikely to get sick even when friends are (incl. NA)
  "PVDr6"          = PVDr6,             # Susceptible to infectious diseases (incl. NA)
  "PVDr7"          = PVDr7,             # Wash hands soon after shaking hands (incl. NA)
  "PVDr8"          = PVDr8,             # Susceptible to colds, flus, and other infectious diseases (incl. NA)
  "PVDr9"          = PVDr9,             # Dislike used clothing because you don't know how past person was like (incl. NA)
  "PVDr10"         = PVDr10,            # More likely to catch infectious diseases than others (incl. NA)
  "PVDr11"         = PVDr11,            # Hands do not feel dirty after touching money (incl. NA)
  "PVDr12"         = PVDr12,            # Unlikely to catch cold, flus, other illness even if going around (incl. NA)
  "PVDr13"         = PVDr13,            # Does not make me anxious to be around sick people (incl. NA)
  "PVDr14"         = PVDr14,            # Immune system protects me from most illnesses that others get (incl. NA)
  "PVDr15"         = PVDr15,            # Avoid public telephones because of risk of catching something from previous user (incl. NA)
  "SSQr1"          = SSQr1,             # Satisfaction with personal relationships (incl. NA)
  "SSQr2"          = SSQr2,             # Satisfaction with support from friends (incl. NA)
  "CVSQ8_Q9CVSQ9a" = CVSQ8_Q9CVSQ9a,    # COVID-19 affected mental health (incl. NA)
  "CVSQ8_Q9CVSQ9b" = CVSQ8_Q9CVSQ9b     # social distancing affected mental health (incl. NA)
)

# These variables need to be passed through mice to impute NA values
vars_con_NA <- bind_cols(
  # Continuous variables; impute with pmm for numeric
  "S6Fr1"          = S6Fr1,             # Number living in household (incl. NA)
  "S6Gr1"          = S6Gr1,             # Number of children under 6 (incl. NA)
  "S6Gr2"          = S6Gr2,             # Number of children 6 to 12 (incl. NA)
  "S6Gr3"          = S6Gr3              # Number of children 13 to 17 (incl. NA)
)

# These variables need SOME NAs converted to 0 then combined with vars_con_NA
vars_catnom_convertto0andNA <- bind_cols(
  # Convert NA to 0 then convert 99 to NA
  "S7C"            = S7C,               # Temporarily or permanently laid off (y/n/NA)
)

S7C[is.na(S7C)] <- 0
S7C[which(S7C == 99)] <- NA
vars_catnom_NA <- bind_cols(
  "S7C" = S7C
)

# These variables need SOME NAs converted to 0 then combined with vars_con_NA
vars_con_convertto0andNA <- bind_cols(
  # Combine noanswerS15_r0 and noanswerS15_r1 with S15r99; impute noanswerS15_r2 with pmm for numeric
  "S15r99" = S15r99,   # con; Number of drinks in last 7 days (incl. NA; convert NA from r0 and r1 to 0)
  
  # Combine noanswerS16C_r1 with S16Cr99; impute noanswerS16C_r2 with pmm for numeric
  "S16Cr99" = S16Cr99, # con; Number of cannabis products in last 7 days (incl. NA; convert NA from r0 and r1 to 0)
  
  # Combine noanswerS17A_r0 and noanswerS17A_r1 with S17Ar99; impute noanswerS17A_r2 with pmm for numeric
  "S17Ar99" = S17Ar99, # con; Number of cigarettes in last 7 days (incl. NA; convert NA from r0 and r1 to 0)
  
  # Combine noanswerS17B_r0 and noanswerS17B_r1 with S17Ar99; impute noanswerS17B_r2 with pmm for numeric
  "S17Br99" = S17Br99  # con; Number of times e-cigarettes used in last 7 days (incl. NA; convert NA from r0 and r1 to 0)
)


S15r99[which(noanswerS15_r0 == 1)] <- 0
S15r99[which(noanswerS15_r1 == 1)] <- 0
S16Cr99[which(S16A == 0)] <- 0
S16Cr99[which(noanswerS16C_r1 == 1)] <- 0
S17Ar99[which(noanswerS17A_r0 == 1)] <- 0
S17Ar99[which(noanswerS17A_r1 == 1)] <- 0
S17Br99[which(noanswerS17B_r0 == 1)] <- 0
S17Br99[which(noanswerS17B_r1 == 1)] <- 0
vars_con_NA <- bind_cols(
  vars_con_NA,
  "S15r99" = S15r99,
  "S16Cr99" = S16Cr99,
  "S17Ar99" = S17Ar99,
  "S17Br99" = S17Br99
)


# Variables below contain non-valid answers that need to be converted for imputation

# These variables need non-valid answers converted to NA then combined with vars_cat_NA
vars_catbin_converttoNA <- bind_cols(
  # Categorical variables; binary
  "S8D"         = S8D,              # Received government stimulus (y/n/"rather not say")
  "S8F"         = S8F,              # Received employment insurance (y/n/"rather not say")
  "C2"          = C2,               # Close contact of COVID-19 (y/n/"unsure")
  "S7B"         = S7B               # Laid off because of COVID-19 (y/n/"rather not say")
)

S8D[which(S8D == 99)] <- NA
S8F[which(S8F == 99)] <- NA
C2[which(C2 == 3)] <- NA
S7B[which(S7B == 99)] <- NA
vars_catbin_NA <- bind_cols(
  vars_catbin_NA,
  "S8D"         = S8D,
  "S8F"         = S8F,
  "C2"          = C2, 
  "S7B"         = S7B 
)

# These variables need non-valid answers converted to NA then combined with vars_catnom_NA
vars_catnom_converttoNA <- bind_cols(
  # Categorical variables; unordered
  "S3"          = S3,               # Gender (incl. other/prefer not to answer/rather not say; NB non-Male and non-Female answers have very low samples so combine with others)
  "S4"          = S4,               # Racial or ethnic group (incl. "rather not say")
  "S5"          = S5,               # Religion (incl. "rather not say")
  "S6B"         = S6B,              # Type of dwelling (incl. "rather not say")
  "S7A"         = S7A,              # Employment status (incl. "rather not say")
  "Q8AA"        = Q8AA              # Ever had depression, anxiety, or mental health issues (incl. NA with unknown values; convert 4 to NA)
)

S3[-which(S3 %in% c(1,2))] <- NA
S4[which(S4 == 99)] <- NA
S5[which(S5 == 99)] <- NA
S6B[which(S6B == 99)] <- NA
S7A[which(S7A == 99)] <- NA
Q8AA[which(Q8AA == 4)] <- NA
vars_catnom_NA <- bind_cols(
  vars_catnom_NA,
  "S3"          = S3, 
  "S4"          = S4, 
  "S5"          = S5, 
  "S6B"         = S6B,
  "S7A"         = S7A,
  "Q8AA"        = Q8AA
)

# These variables need non-valid answers converted to NA then combined with vars_ord_NA
vars_ord_converttoNA <- bind_cols(
  # Ordinal variables; ordered
  "S11A"        = S11A,             # Father's level of education (incl. "don't know")
  "S11C"        = S11C,             # Mother's level of education (incl. "don't know")
  "S1B"         = S1B,              # Population of area (incl. NA and "don't know")
  "S6H"         = S6H               # Household income (incl. no-responses)
)

S11A[which(S11A == 99)] <- NA
S11C[which(S11C == 99)] <- NA
S1B[which(S1B == 5)] <- NA
S6H[which(S6H == 99)] <- NA
vars_ord_NA <- bind_cols(
  vars_ord_NA,
  "S11A"        = S11A,
  "S11C"        = S11C,
  "S1B"         = S1B, 
  "S6H"         = S6H  
)

```

We have now classified all variables in `coviddata_exclNA`. In the next section, we will impute any remaining `NA` values in the dataset.

### 4.2.3 Imputing missing data

Imputation replaces missing data with substituted values. A common approach is "imputation to the mean", where missing values are replaced with the mean value of the respective variable. However, this approach artificially reduces the variance of the dataset and does not take into account additional information from other variables. 

"Multiple Imputation by Chained Expressions" (MICE) is a more sophisticated approach for imputing missing data. If the pattern of missing data is random, then the statistical distribution of (unobserved) missing values should be no different from the (observed) existing data. As such, we can impute the missing data by resampling values from the existing data. We can also improve the quality imputation by using the observed data to predict likely values for the missing data. 

In the previous section, we classified all variables listed in `datadict_exclNA` according to type, with `vars_cat`, `vars_con`, and `vars_ord` respectively containing all categorical, continuous, and ordinal variables that *did not require any preprocessing*. Variables that encoded any type of nonresponse were identified for preprocessing. Then, we recoded meaningful nonresponses as explicit values (e.g., `NA`s in `S7C` converted to `0`s) and random/nonsensical nonresponses as `NA`s. After recoding, variables that contained no `NA` values were appended to their respective `vars_{type}` list. Since imputation methods depend on data type, variables with `NA` values were saved into `vars_catbin_NA` (for binary categorical variables), `vars_catnom_NA` (for categorical variables with > 2 groups), `vars_con_NA`, and `vars_ord_NA`. 

In the next code chunk, we will combine the `vars_{type}` objects into `data_preimpute`. Then, we will append `vars_{type}_NA` to `data_preimpute` to make `data_preimpute_{type}_NA`. This object is passed to `mice()`, which performs multiple imputation to replace any `NA`s with sensible values. The output is saved to `data_impute_{type}_NA`, and the imputed values from each object are recombined into a final complete dataset named `coviddata_imp`. Finally, we'll clean up the environment and remove all R objects that will no longer be used.

**Please note that imputation is computationally intensive and can take several hours to complete. For the purposes of this report, the `data_impute_{type}_NA` objects were previously computed and are loaded into R from .RDS files.**

```{r impute}

# For each of the vars_X_NA, we need to impute the NA values. We can use the
# mice package to do this!

haven_binarize_yesno <- function(x) {
  a <- as_factor(x) %>% as.character()
  a[which(a == "No")] <- 0
  a[which(a == "Yes")] <- 1
  a <- as.numeric(a)
  return(a)
}

haven_ordered <- function(x) {
  a <- as_factor(x, ordered = TRUE, levels = "values")
  return(a)
}


# Prep datasets for each imputation

data_preimpute <- bind_cols(
  vars_cat %>% mutate(across(everything(), as_factor)),
  vars_ord %>% mutate(across(everything(), haven_ordered)),
  vars_con
)

data_preimpute_catbin_NA <- bind_cols(
  data_preimpute,
  vars_catbin_NA %>% mutate(across(everything(), as_factor))
) %>% zap_labels()

data_preimpute_catnom_NA <- bind_cols(
  data_preimpute,
  vars_catnom_NA %>% mutate(across(everything(), as_factor))
) %>% zap_labels()

data_preimpute_ord_NA <- bind_cols(
  data_preimpute,
  vars_ord_NA %>% mutate(across(everything(), haven_ordered))
  # vars_con_NA
) %>% zap_labels()

data_preimpute_con_NA <- bind_cols(
  data_preimpute,
  vars_con_NA
) %>% zap_labels()


# Check if data set has already been imputed and is unchanged; otherwise, redo

if (file.exists(paste0(getwd(), "/output/data_impute_catbin_NA.RDS"))) {
  data_check <- readRDS(file = paste0(getwd(), "/output/data_impute_catbin_NA.RDS"))
} else {
  data_check <- NULL
}

if (setequal(data_check$data, data_preimpute_catbin_NA)) {
  data_impute_catbin_NA <- data_check
} else {
  data_impute_catbin_NA <- mice(
    data = data_preimpute_catbin_NA,
    nnet.MaxNWts = 50000,
    seed = 1
  )
  saveRDS(object = data_impute_catbin_NA, 
          file = paste0(getwd(), "/output/data_impute_catbin_NA.RDS"))
}

if (file.exists(paste0(getwd(), "/output/data_impute_catnom_NA.RDS"))) {
  data_check <- readRDS(file = paste0(getwd(), "/output/data_impute_catnom_NA.RDS"))
} else {
  data_check <- NULL
}

if (setequal(data_check$data, data_preimpute_catnom_NA)) {
  data_impute_catnom_NA <- data_check
} else {
  data_impute_catnom_NA <- mice(
    data = data_preimpute_catnom_NA,
    nnet.MaxNWts = 50000,
    seed = 1
  )
  
  saveRDS(object = data_impute_catnom_NA, 
          file = paste0(getwd(), "/output/data_impute_catnom_NA.RDS"))
}

if (file.exists(paste0(getwd(), "/output/data_impute_ord_NA.RDS"))) {
  data_check <- readRDS(file = paste0(getwd(), "/output/data_impute_ord_NA.RDS"))
} else {
  data_check <- NULL
}

if (setequal(data_check$data, data_preimpute_ord_NA)) {
  data_impute_ord_NA <- data_check
} else {
  data_impute_ord_NA <- mice(
    data = data_preimpute_ord_NA,
    nnet.MaxNWts = 50000,
    seed = 1
  )
  
  saveRDS(object = data_impute_ord_NA, 
          file = paste0(getwd(), "/output/data_impute_ord_NA.RDS"))
}

if (file.exists(paste0(getwd(), "/output/data_impute_con_NA.RDS"))) {
  data_check <- readRDS(file = paste0(getwd(), "/output/data_impute_con_NA.RDS"))
} else {
  data_check <- NULL
}

if (setequal(data_check$data, data_preimpute_con_NA)) {
  data_impute_con_NA <- data_check
} else {
  data_impute_con_NA <- mice(
    data = data_preimpute_con_NA,
    nnet.MaxNWts = 50000,
    seed = 1
  )
  
  saveRDS(object = data_impute_con_NA, 
          file = paste0(getwd(), "/output/data_impute_con_NA.RDS"))
}

data_complete <- left_join(
  x = complete(data_impute_catbin_NA),
  y = complete(data_impute_catnom_NA),
  by = names(data_preimpute)
)

data_complete <- left_join(
  x = data_complete,
  y = complete(data_impute_ord_NA),
  by = names(data_preimpute)
)

data_complete <- left_join(
  x = data_complete,
  y = complete(data_impute_con_NA),
  by = names(data_preimpute)
)

detach(coviddata_exclNA)

# Save out objects required for analysis, then clean up the environment

coviddata_imp <- data_complete
datadict_imp <- datadict[names(data_complete)]
vars_imp <- list(
  cat = c(names(vars_cat),
          names(vars_catbin_NA),
          names(vars_catnom_NA)),
  con = c(names(vars_con),
          names(vars_con_NA)),
  ord = c(names(vars_ord),
          names(vars_ord_NA))
)

write_csv(data_complete, file = paste0(getwd(), "/output/data_imputed.csv"))

rm(
  C1B,
  C1C,
  C2,
  # coviddata,
  coviddata_exclNA,
  # coviddata_imp,
  coviddata_num,
  data_check,
  data_complete,
  data_impute_catbin_NA,
  data_impute_catnom_NA,
  data_impute_con_NA,
  data_impute_ord_NA,
  data_preimpute,
  data_preimpute_catbin_NA,
  data_preimpute_catnom_NA,
  data_preimpute_con_NA,
  data_preimpute_ord_NA,
  # datadict,
  datadict_exclNA,
  # datadict_imp,
  haven_binarize_yesno,
  haven_ordered,
  noanswerS16C_r1,
  noanswerS16C_r2,
  Q8AA,
  # required_packages,
  S11A,
  S11C,
  S15r99,
  S16B,
  S16Cr99,
  S17Ar99,
  S17Br99,
  S1B,
  S3,
  S4,
  S5,
  S6B,
  S6E,
  S6H,
  S7A,
  S7B,
  S7C,
  S8D,
  S8F,
  # using,
  vars_cat,
  vars_catbin_converttoNA,
  vars_catbin_NA,
  vars_catnom_convertto0,
  vars_catnom_convertto0andNA,
  vars_catnom_converttoNA,
  vars_catnom_NA,
  vars_con,
  vars_con_convertto0andNA,
  vars_con_NA,
  vars_dealwithlater,
  vars_excl,
  # vars_imp,
  vars_na1,
  vars_na2,
  vars_na3,
  vars_naall,
  vars_ord,
  vars_ord_converttoNA,
  vars_ord_NA
)

```

Before we move onto the next section, let's take one last look at the missing data structure of `coviddata_imp`. 

```{r plotmissing6}
coviddata_imp %>% plot_missing(data = ., title = "Figure 6", subtitle = "Missing values in coviddata_imp")
```

As we can see, there is no yellow in this chart! There are no missing values in the data. This complete data is now ready for outlier analysis and inferential statistics!

**Let's move onto** [***Part 3***]().
